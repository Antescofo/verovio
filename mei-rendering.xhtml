---
layout: verovio
title: MEI Rendering
active: mei-rendering
downloads:
    - name: "Guami Canzona 24"
      description: "8 voices and b.c., 10 pages - 235Kb"
      link: "Guami_Canzona_24.mei"
    - name: "Hummel Concerto"
      description: "Orchestra score, 121 pages - 7Mb"
      link: "Hummel_Concerto_for_trumpet.mei"
    - name: "Krebs Trio in Eb"
      description: "Organ score, 6 pages - 380Kb"
      link: "Krebs_Trio_Eb_2.mei"
    - name: "Beethoven Op 18/1"
      description: "String quartet, 18 pages - 1.1Mb"
      link: "Beethoven_op.18_1.mei"
    - name: "Brahms Op 51/1"
      description: "String quartet, 7 pages - 640Kb"
      link: "Brahms_StringQuartet_Op51_No1.mei"
---

<script type="text/javascript">
//<![CDATA[
	var vrvToolkit = new verovio.toolkit();
	var page = 1;
	var zoom = 40;
	var pageHeight = 2970;
	var pageWidth = 2100;
	var swipe_pages = false;

	function upload_file(input, format) {
		
		var file = document.getElementById(input).files[0];
		var reader = new FileReader();

		// Closure to capture the file information.
		reader.onload = (function(theFile) {
			return function(e) {
				load_data(e.target.result, format);
			};
		})(file);

		// Read in the image file as a data URL.
		reader.readAsText(file);
	};
	
	function load_data(data, format) {
		ignoreLayout = 0;
		if ( document.getElementById('ignoreLayout').checked ) {
			ignoreLayout = 1;
		}
		options = JSON.stringify({
					inputFormat: format,
					border: 50,
					scale: 10,
					ignoreLayout: ignoreLayout
				});
		vrvToolkit.setOptions( options );
		vrvToolkit.loadData(data);

		document.getElementById("total_text").innerHTML = vrvToolkit.getPageCount();
		page = 1;
		load_page();
	}

	function load_page() {
		document.getElementById('jump_text').value = page;

		svg = vrvToolkit.renderPage(page, "");
		document.getElementById('svg_output').innerHTML = svg;
		
		apply_zoom();		
	};

	function next_page() {
		if (page >= vrvToolkit.getPageCount()) {
			return;
		}

		page = page + 1;
		load_page();
	};

	function prev_page() {
		if (page <= 1) {
			return;
		}

		page = page - 1;
		load_page();
	};

	function first_page() {
		page = 1;
		load_page();
	};
	
	function last_page() {
		page = vrvToolkit.getPageCount();
		load_page();
	};

	function apply_zoom() {
		/*
		vrvToolkit.setOptions(JSON.stringify({
			scale: zoom
		}));
		load_page();
		*/
		
		$('#svg_panel svg g.page-scale').attr("transform", "scale(" + zoom / 100 + ", "+ zoom / 100 +")") ;
		adjust_page_height();
	}

	function zoom_out() {
		if (zoom < 20) {
			return;
		}

		zoom = zoom / 2;
		apply_zoom();
	}

	function zoom_in() {
		if (zoom > 80) {
			return;
		}

		zoom = zoom * 2;
		apply_zoom();
	}

	function do_page_enter(e) {
		key = e.keyCode || e.which;
		if (key == 13) {

			text = document.getElementById('jump_text').value;

			if (text <= vrvToolkit.getPageCount() && text > 0) {
				page = Number(text);
				load_page();
			} else {
				document.getElementById('jump_text').value = page;
			}

		}
	}

	function do_zoom_enter(e) {
		key = e.keyCode || e.which;
		if (key == 13) {
			text = document.getElementById('zoom_text').value;
			zoom = Number(text);
			apply_zoom( );
		}
	}
	
	function adjust_page_height() {
		// adjust the height of the panel
		if ( $('#svg_panel svg') ) {
			$('#svg_output').height( (pageHeight * zoom / 100) + 10 ); // slighly more for making sure we have no scroll bar	
			$('#svg_panel svg').height(pageHeight * zoom / 100 );
			$('#svg_panel svg').width(pageWidth * zoom / 100 );	
		}
		
		// also update the zoom control
		document.getElementById('zoom_text').value = zoom + "%";
		
		// enable the swipe (or not)
		enable_swipe( ( $('#svg_panel svg') && ( $('#svg_panel svg').width() <= $('#svg_panel').width() ) ) );
	}
    
	function swipe_prev(event, direction, distance, duration, fingerCount) {
     	prev_page();
    }

    function swipe_next(event, direction, distance, duration, fingerCount) {
		 next_page();
    }

    function swipe_zoom_in(event, target) {
		 zoom_in();
    }
	
    function swipe_zoom_out(event, target) {
		 zoom_out();
    }
	
	function enable_swipe( pages ) {
		if ( pages && !swipe_pages ) {
			$("#svg_output").swipe( "destroy" );
			$("#svg_output").swipe( { swipeLeft: swipe_next, swipeRight: swipe_prev, tap: swipe_zoom_in, doubleTap: swipe_zoom_out, allowPageScroll:"auto"} );
			swipe_pages = true;
		}
		// zoom only
		else if ( !pages && swipe_pages ) {
			$("#svg_output").swipe( "destroy" );
			$("#svg_output").swipe( { tap: swipe_zoom_in, doubleTap: swipe_zoom_out, allowPageScroll:"auto"} );
			swipe_pages = false;		
		}
	}

//]]>
</script>

<div class="row">
	<div class="col-sm-8 col-md-9">
		<div class="panel panel-default hidden-xs hidden-sm hidden-print">
			<div class="panel-heading">
				<div class="row">
					<div class="col-xs-10">
						MEI file and optional parameters
					</div>
					<div class="col-xs-2">
						<button id="toggle-options" class="btn btn-default btn-xs btn-heading pull-right" type="button">
							<span class="glyphicon glyphicon-chevron-down"/>
						</button>
						<button id="options-help" class="btn btn-default btn-xs btn-heading pull-right" type="button">
							<span class="glyphicon glyphicon-question-sign"/>
						</button>
					</div>
				</div>
			</div>
			
			<div id="options_body_panel" class="panel-body">
				<form id="upload_form" onsubmit="upload_file('mei_files', 'mei'); return false" class="form-inline" role="form">
					<div class="row">
						<div class="col-md-10">
							<input type="file" id="mei_files" name="file" style="margin: 4px 0px 8px 0px;"/>
						</div>
						<div class="col-md-2">
							<button type="submit" class="btn btn-default btn-sm pull-right">Render</button>
						</div>
					</div>
					<!-- /.row -->
					<hr class="panel"/>
					<div class="row">
						<div class="col-md-3">
							<div class="checkbox">
								<label class="checkbox">
									<input id="ignoreLayout" type="checkbox"/> Ignore encoded layout
						      	</label>
							</div>
						</div>
						<!-- /.col-xs -->
						<div class="col-md-3">
							<div class="checkbox">
								<label class="checkbox">
									<input id="adjustPageHeight" type="checkbox"/> Adjust height to content
						      	</label>
							</div>
						</div>
						<!-- /.col-xs -->
						<div class="col-md-6">
						    <div class="col-md-4 form-group">
						      <input type="text" class="form-control" id="pageHeight" placeholder="Height"/>
						    </div>
						    <div class="col-md-4 form-group">
						      <input type="text" class="form-control" id="pageWidth" placeholder="Width"/>
						    </div>
						    <div class="col-md-4 form-group">
						      <input type="text" class="form-control" id="border" placeholder="Margin"/>
						    </div>
						</div>
						<!-- /.col-xs -->
					</div>
					<!-- /.row -->
					
					<div id="help_panel" style="display: none">
						<hr class="panel"/>
						<h5>Ignore encoded layout</h5>
						<p>
							Make Verovio ignore the encoded layout information (if any) and have it fully recalculated
						</p>
						<h5>Adjust height to content</h5>
						<p>
							Crop the page height to the height of the content
						</p>
						<h5>Height</h5>
						<p>
							Specify the page height (default is 2970)
						</p>
						<h5>Width</h5>
						<p>
							Specify the page width (default is 2100)
						</p>
						<h5>Margin</h5>
						<p>
							Add a margin (default is 50)
						</p>
					</div>
					
				</form>
			</div>
		</div>
		
		<div id="svg_panel" class="panel panel-default">
			<div id="svg_output" style="overflow:auto;">
			</div>
		</div>
	</div>
	<div class="col-sm-4 col-md-3 sidebar-offcanvas hidden-print" id="sidebar" role="navigation">
			
		<div class="panel panel-default">
			<div class="panel-heading">
				<div class="row">
					<div class="col-xs-10">
						Navigation
					</div>
					<div class="col-xs-2">
						<button class="btn btn-default btn-xs btn-heading pull-right popover-btn" type="button" data-container="body" data-toggle="popover" data-placement="left" data-content="On mobile devices, you can swipe left or right to change page and tap or double tap to zoom-in or zoom-out.">
							<span class="glyphicon glyphicon-question-sign"/>
						</button>
					</div>
				</div>
			</div>
			<div class="panel-body">
				<div class="row">
					<div class="col-md-12">
						<p>
							Go to page [1-<span id="total_text">1</span>]:
						</p>
						<div class="col-xs-1 input-group input-group-sm">
							<span class="input-group-btn">
								<button onclick="first_page()" class="btn btn-default" type="button">
									<span class="glyphicon glyphicon-fast-backward"/>
								</button>
								<button onclick="prev_page()" class="btn btn-default" type="button">
									<span class="glyphicon glyphicon-backward"/>
								</button>
							</span>
							<input type="text" class="form-control" placeholder="0" id="jump_text" style="width:45px" onkeypress="do_page_enter(event)"/>
							<span class="input-group-btn">
								<button onclick="next_page()" class="btn btn-default" type="button">
									<span class="glyphicon glyphicon-forward"/>
								</button>
								<button onclick="last_page()" class="btn btn-default" type="button">
									<span class="glyphicon glyphicon-fast-forward"/>
								</button>
							</span>
						</div>
						<!-- /input-group -->
					</div>
					<!-- /.col-lg-6 -->
				</div>
				<!-- /.row -->
				<hr/>
				<div class="row">
					<div class="col-md-6">
						<p>
							Zoom:
						</p>
						<div class="col-xs-2 input-group input-group-sm">
							<span class="input-group-btn">
								<button onclick="zoom_out()" class="btn btn-default" type="button">
									<span class="glyphicon glyphicon-zoom-out"/>
								</button>
							</span>
							<input type="text" class="form-control" style="width:60px" placeholder="100%" id="zoom_text" onkeypress="do_zoom_enter(event)"/>
							<span class="input-group-btn">
								<button onclick="zoom_in()" class="btn btn-default" type="button">
									<span class="glyphicon glyphicon-zoom-in"/>
								</button>
							</span>
						</div>
						<!-- /input-group -->
					</div>
					<!-- /.col-md-6 -->
				</div>
				<!-- /.row -->
			</div>
		</div>
		<div class="panel panel-default hidden-xs hidden-sm">
			<div class="panel-heading">
				<div class="row">
					<div class="col-xs-10">
						Example files to download
					</div>
					<div class="col-xs-2">
						<button class="btn btn-default btn-xs btn-heading pull-right popover-btn" type="button" data-container="body" data-toggle="popover" data-placement="left" data-content="These files can be downloaded locally on your machine and then selected for rendering in your browser">
							<span class="glyphicon glyphicon-question-sign"/>
						</button>
					</div>
				</div>
			</div>
			<div class="panel-body">
				<div class="row">
					<div class="col-md-12">
						{% for d in page.downloads %}
						<p><a href="{{ site.baseurl }}/examples/downloads/{{ d.link }}">{{ d.name }}</a><br/>
						    {{ d.description }}
						 </p>
						{% endfor %}
					</div>
					<!-- /.col-md-6 -->
				</div>
				<!-- /.row -->
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
//<![CDATA[
	$( document ).ready(function() {
		
		// Toggle for the options help
		$( "#options-help" ).click(function() {
			$( "#help_panel" ).slideToggle();	
		});
		
		$('#toggle-options').click(function(){
			$( "#options_body_panel" ).toggle();
		  	// toggle icon
		  	$("span", this).toggleClass("glyphicon-chevron-left glyphicon-chevron-down");
		});
		
		// Set the popover for the btn
		$( ".popover-btn" ).popover( );
		
		// Adjust the size of the svg_output and the zoom according to the div (screen) size
	    width = $('#svg_panel').width();
		zoom = Math.floor( 100 * width / 2100 );
		$("#svg_output").height( zoom * 30 ); // slighly more for making sure we have no scroll bar (3000 for default height of 2970)
		
		// Init the swip
		enable_swipe( true );
	
		// Load the default file or the file passed in the URL
		var file = location.search.substring(1);
		if (file.length != 0) {
			$.get( file , function( data ) {
				load_data( data, 'mei');
			});
		}
	});
//]]>
</script>
