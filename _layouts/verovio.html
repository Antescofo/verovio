<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>{{ page.title }}</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" /><!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" type="text/css" /><!-- Optional theme -->
		<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap-theme.min.css" type="text/css" />
	</head>
	<body>
		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="https://code.jquery.com/jquery.js" type="text/javascript" ></script>
		<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js" type="text/javascript" ></script>
		<script src="{{ site.baseurl }}/javascript/verovio-toolkit.js" type="text/javascript" ></script>
		<script type="text/javascript">
			var vrvToolkit = new verovio.toolkit();
			var page = 1;
			var zoom = 40;

			function upload_file(input, format) {

				var file = document.getElementById(input).files[0];

				var reader = new FileReader();

				// Closure to capture the file information.
				reader.onload = (function(theFile) {
					return function(e) {
						vrvToolkit.setOptions(JSON.stringify({
							inputFormat: format,
							scale: 100,
							pageWidth: 2100,
							border: 0
						}));
						vrvToolkit.loadData(e.target.result);

						document.getElementById("total_text").innerHTML = vrvToolkit.getPageCount();

						//zoom = 40;
						page = 1;
						set_zoom(zoom);
						// set_zoom calls goto page
						//goto_page(page);
					};
				})(file);

				// Read in the image file as a data URL.
				reader.readAsText(file);

			};


			function goto_page(page_nr) {
				document.getElementById('jump_text').value = page_nr;

				svg = vrvToolkit.renderPage(page_nr, "");
				document.getElementById('svg_output').innerHTML = svg;
			};

			function next_page() {
				if (page >= vrvToolkit.getPageCount()) {
					return;
				}

				page = page + 1;
				goto_page(page);
			};

			function prev_page() {
				if (page <= 1) {
					return;
				}

				page = page - 1;
				goto_page(page);
			};

			function set_zoom(zoom_nr) {
				vrvToolkit.setOptions(JSON.stringify({
					scale: zoom_nr
				}));
				goto_page(page);

				document.getElementById('zoom_text').value = zoom_nr + "%";
			}

			function zoom_out() {
				if (zoom <= 10) {
					return;
				}

				zoom = zoom - 10;
				set_zoom(zoom);
			}

			function zoom_in() {
				if (zoom > 150) {
					return;
				}

				zoom = zoom + 10;
				set_zoom(zoom);
			}

			function do_page_enter(e) {
				key = e.keyCode || e.which;
				if (key == 13) {

					text = document.getElementById('jump_text').value;

					if (text <= vrvToolkit.getPageCount() && text > 0) {
						page = Number(text);
						goto_page(page);
					} else {
						document.getElementById('jump_text').value = page;
					}

				}
			}

			function do_zoom_enter(e) {
				key = e.keyCode || e.which;
				if (key == 13) {

					text = document.getElementById('zoom_text').value;

					if (text < 150 && text > 10) {
						zoom = Number(text);
						set_zoom(zoom);
					}

				}
			}
		</script>
		<div class="container">
			
			{% include header.html %}
			
			<hr />
			
			{{ content }}
			
		</div>
	</body>
</html>
